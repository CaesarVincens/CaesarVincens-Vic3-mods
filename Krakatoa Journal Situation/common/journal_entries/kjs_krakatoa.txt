je_krakatoa = {
	icon = "gfx/interface/icons/state_trait_icons/disaster_zone.dds"

	group = je_group_com_situations

	scripted_progress_bar = je_krakatoa_thermometer_progress_bar

	on_monthly_pulse = {
		random_events = {
			10 = 0
			2 = krakatoa.4 #art boom
			5 = krakatoa.3 #crop failure
		}

		effect = {
			trigger_event = {
				on_action = krakatoa_on_action
			}
			hidden_effect = {
				if = {
					limit = {
						has_modifier = krakatoa_cost_modifier
						is_com_situation_faction_member = {
							side = neutral
							faction = kjs_bystanders
						}
					}
					reassign_com_situation_faction_country = {
						side = neutral
						name = kjs_humanitarians
						country = root
					}
				}
			}
			sort_com_situation_faction = {
				side = neutral
				name = kjs_affected
				order = prestige
			}
			sort_com_situation_faction = {
				side = neutral
				name = kjs_humanitarians
				order = prestige
			}
			sort_com_situation_faction = {
				side = neutral
				name = kjs_bystanders
				order = prestige
			}
		}
	}

	immediate = {
		create_com_situation_no_sides = {
			situation_id = kjs_je_krakatoa
			icon = kjs_icon_krakatoa
		}
		create_com_situation_faction = {
			side = neutral
			name = kjs_affected
			desc = kjs_affected_desc
		}
		create_com_situation_faction = {
			side = neutral
			name = kjs_humanitarians
			desc = kjs_humanitarians_desc
		}
		create_com_situation_faction = {
			side = neutral
			name = kjs_bystanders
			desc = kjs_bystanders_desc
		}
		if = {
			limit = {
				any_scope_state = {
					AND = {
						devastation > 0
						state_region = {
							has_variable = is_tsunami_state
						}
					}
				}
			}
			add_com_situation_faction_country = {
				side = neutral
				name = kjs_affected
				country = root
			}
			every_scope_state = {
				limit = {
					AND = {
						devastation > 0
						state_region = {
							has_variable = is_tsunami_state
						}
					}
				}
				root = {
					add_to_variable_list = {
						name = krakatoa_states
						target = prev
					}
				}
			}
		}
		else = {
			add_com_situation_faction_country = {
				side = neutral
				name = kjs_bystanders
				country = root
			}
		}
	}

	on_weekly_pulse = {
		effect = {
			clear_variable_list = krakatoa_states
			if = {
				limit = {
					any_scope_state = {
						AND = {
							devastation > 0
							state_region = {
								has_variable = is_tsunami_state
							}
						}
					}
				}
				every_scope_state = {
					limit = {
						AND = {
							devastation > 0
							state_region = {
								has_variable = is_tsunami_state
							}
						}
					}
					root = {
						add_to_variable_list = {
							name = krakatoa_states
							target = prev
						}
					}
				}
			}
		}
	}

	on_timeout = {
		clear_variable_list = krakatoa_states
		if = {
			limit = {
				exists = global_var:krakatoa_temperature_drop
				exists = global_var:krakatoa_temperature_recovery_rate
			}
			remove_global_variable = krakatoa_temperature_drop
			remove_global_variable = krakatoa_temperature_recovery_rate
		}
	}

	timeout = normal_modifier_time

	weight = 100

	should_be_pinned_by_default = yes

	transferable = yes
}
